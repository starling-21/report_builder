{% extends 'reports/base.html' %}
{% block extra_head %}
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/css/bootstrap-select.min.css">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.9/dist/js/bootstrap-select.min.js"></script>
{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div class="col-4">
                <form method="POST">
                    {% csrf_token %}
                    <input type="text" id="searched_data">
                    <input id="search-button" type="submit" value="Ok">
                </form>
            </div>


            <div class="col-4">
                <form method="POST">
                    {% csrf_token %}
                        <div id="test_members">
                            {% for serviceman in service_members_list %}
                                {{ serviceman.rank }} {{ serviceman }}<br>
                            {% endfor %}
                        </div>
                </form>
            </div>


            <div class="col-4">
{#                <form method="POST">#}
{#                    {% csrf_token %}#}
{#                    <div id="test_members">#}
                        <select id="member-selected" class="selectpicker" data-live-search="true" data-width="auto">
                            {% for serviceman in service_members_list %}
                                <option value="{{ serviceman.id }}">
                                    {{ serviceman.rank }} {{ serviceman }}
                                </option>
                            {% endfor %}
                        </select>
{#                        <input type="submit" value="Ok" id="selection-button">#}
{#                    </div>#}
{#                </form>#}
            </div>
        </div>
    </div>

{% endblock %}


{% block js_scripts %}

    <script>
        var csrf_token = '{{ csrf_token }}';
        $('#search-button').click(function (event) {
            event.preventDefault();
            var searched_input = $('#searched_data').val();
            $.ajax({
                url: 'search_member',
                method: 'POST',
                data: {
                    csrfmiddlewaretoken: csrf_token,
                    filter_param: searched_input
                },
                dataType: 'json',
                success: function (data) {
                    console.log("success")
                    console.log(data)
                    {#$('#test_members').html("data")#}
                    parse_response(data)
                },
                error: function (error_data) {
                    console.log("error")
                    console.log(error_data)
                }
            });
        });

        function parse_response(data_arr) {
            $('#test_members').html('')
            data_arr.forEach(function (arrayItem) {
                var x = arrayItem.id
                var name = arrayItem.name
                $('#test_members').append(name + '<br>')
            });

            $('#member-selected').html('')
            data_arr.forEach(function (arrayItem) {
                var x = arrayItem.id
                var name = arrayItem.name
                $('#member-selected').append('<option value=' + x + '>' +
                    name +
                    '</option>')
            });
        }

        $('#member-selected').on('change', function() {
        var selectText = $( "#member-selected option:selected" ).text();
        alert(selectText);
        });

        $('#bs-searchbox').on('change', function() {
        var selectText = $( "#member-selected option:selected" ).text();
        alert(selectText);
        });

    </script>

{% endblock %}